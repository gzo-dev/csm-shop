"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.queue = exports["default"] = void 0;
var _kue = _interopRequireDefault(require("kue"));
var _models = require("./models");
var _config = _interopRequireDefault(require("./config"));
var queue = _kue["default"].createQueue({
  prefix: 'q',
  redis: {
    host: _config["default"].redis.host,
    port: _config["default"].redis.port,
    auth: _config["default"].redis.password
  }
});
exports.queue = queue;
var _default = {
  init: function init() {
    queue.process('img-upload', function (job, done) {
      Promise.all([_models.db.productphoto.bulkCreate(job.data.attachmentEntries), _models.db.productphoto.destroy({
        where: {
          id: job.data.productId
        }
      })]).then(function (r) {
        done(true);
      })["catch"](function (err) {
        console.log('error - ' + err);
        done(false);
      });
    });
  }
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfa3VlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfbW9kZWxzIiwiX2NvbmZpZyIsInF1ZXVlIiwia3VlIiwiY3JlYXRlUXVldWUiLCJwcmVmaXgiLCJyZWRpcyIsImhvc3QiLCJjb25maWciLCJwb3J0IiwiYXV0aCIsInBhc3N3b3JkIiwiZXhwb3J0cyIsIl9kZWZhdWx0IiwiaW5pdCIsInByb2Nlc3MiLCJqb2IiLCJkb25lIiwiUHJvbWlzZSIsImFsbCIsImRiIiwicHJvZHVjdHBob3RvIiwiYnVsa0NyZWF0ZSIsImRhdGEiLCJhdHRhY2htZW50RW50cmllcyIsImRlc3Ryb3kiLCJ3aGVyZSIsImlkIiwicHJvZHVjdElkIiwidGhlbiIsInIiLCJlcnIiLCJjb25zb2xlIiwibG9nIl0sInNvdXJjZXMiOlsiLi4vc3JjL2t1ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQga3VlIGZyb20gJ2t1ZSc7XG5pbXBvcnQgeyBkYiB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xuXG5leHBvcnQgdmFyIHF1ZXVlID0ga3VlLmNyZWF0ZVF1ZXVlKHtcbiAgICBwcmVmaXg6ICdxJyxcbiAgICByZWRpczoge1xuICAgICAgICBob3N0OiBjb25maWcucmVkaXMuaG9zdCxcbiAgICAgICAgcG9ydDogY29uZmlnLnJlZGlzLnBvcnQsXG4gICAgICAgIGF1dGg6IGNvbmZpZy5yZWRpcy5wYXNzd29yZFxuICAgIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gICAgaW5pdDogKCkgPT4ge1xuICAgICAgICBxdWV1ZS5wcm9jZXNzKCdpbWctdXBsb2FkJywgZnVuY3Rpb24gKGpvYiwgZG9uZSkge1xuICAgICAgICAgICAgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgICAgIGRiLnByb2R1Y3RwaG90by5idWxrQ3JlYXRlKGpvYi5kYXRhLmF0dGFjaG1lbnRFbnRyaWVzKSxcbiAgICAgICAgICAgICAgICBkYi5wcm9kdWN0cGhvdG8uZGVzdHJveSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogam9iLmRhdGEucHJvZHVjdElkXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIC50aGVuKHIgPT4ge1xuICAgICAgICAgICAgICAgIGRvbmUodHJ1ZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIC0gJyArIGVycik7XG4gICAgICAgICAgICAgICAgZG9uZShmYWxzZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KTtcblxuICAgIH1cblxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLElBQUFBLElBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE9BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUVPLElBQUlHLEtBQUssR0FBR0MsZUFBRyxDQUFDQyxXQUFXLENBQUM7RUFDL0JDLE1BQU0sRUFBRSxHQUFHO0VBQ1hDLEtBQUssRUFBRTtJQUNIQyxJQUFJLEVBQUVDLGtCQUFNLENBQUNGLEtBQUssQ0FBQ0MsSUFBSTtJQUN2QkUsSUFBSSxFQUFFRCxrQkFBTSxDQUFDRixLQUFLLENBQUNHLElBQUk7SUFDdkJDLElBQUksRUFBRUYsa0JBQU0sQ0FBQ0YsS0FBSyxDQUFDSztFQUN2QjtBQUNKLENBQUMsQ0FBQztBQUFDQyxPQUFBLENBQUFWLEtBQUEsR0FBQUEsS0FBQTtBQUFBLElBQUFXLFFBQUEsR0FFWTtFQUNYQyxJQUFJLEVBQUUsU0FBQUEsS0FBQSxFQUFNO0lBQ1JaLEtBQUssQ0FBQ2EsT0FBTyxDQUFDLFlBQVksRUFBRSxVQUFVQyxHQUFHLEVBQUVDLElBQUksRUFBRTtNQUM3Q0MsT0FBTyxDQUFDQyxHQUFHLENBQUMsQ0FDUkMsVUFBRSxDQUFDQyxZQUFZLENBQUNDLFVBQVUsQ0FBQ04sR0FBRyxDQUFDTyxJQUFJLENBQUNDLGlCQUFpQixDQUFDLEVBQ3RESixVQUFFLENBQUNDLFlBQVksQ0FBQ0ksT0FBTyxDQUFDO1FBQ3BCQyxLQUFLLEVBQUU7VUFDSEMsRUFBRSxFQUFFWCxHQUFHLENBQUNPLElBQUksQ0FBQ0s7UUFDakI7TUFDSixDQUFDLENBQUMsQ0FDTCxDQUFDLENBQ0RDLElBQUksQ0FBQyxVQUFBQyxDQUFDLEVBQUk7UUFDUGIsSUFBSSxDQUFDLElBQUksQ0FBQztNQUNkLENBQUMsQ0FBQyxTQUNJLENBQUMsVUFBQWMsR0FBRyxFQUFJO1FBQ1ZDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLFVBQVUsR0FBR0YsR0FBRyxDQUFDO1FBQzdCZCxJQUFJLENBQUMsS0FBSyxDQUFDO01BQ2YsQ0FBQyxDQUFDO0lBQ04sQ0FBQyxDQUFDO0VBRU47QUFFSixDQUFDO0FBQUFMLE9BQUEsY0FBQUMsUUFBQSJ9